<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>浏览器 simplecv.ts 测试</title>
</head>

<body>
  <script src="../lib/tool.js"></script>
  <script>
    "use strict";
    fetch("../build/optimized.wasm")
      .then(response => response.arrayBuffer())
      .then(buffer => WebAssembly.instantiate(buffer, {
        env: {
          memory: new WebAssembly.Memory({
            initial: 1
          }),
          abort: function () {
            throw Error("abort called");
          }
        }
      }))
      .then(module => {
        var exports = module.instance.exports;
        var mem = new Float64Array(exports.memory.buffer);
        console.log(exports);
        console.log(exports.convolution(1, 2));
      }).catch(err => {
        alert("Failed to load WASM: " + err.message + " (ad blocker, maybe?)");
        console.log(err.stack);
      });
  </script>
</body>

</html>